# Shell
alias cs='clear'

## cd shortcuts
alias hm='cd ~'
alias up1='cd ../'
alias up2='cd ../../'
alias up3='cd ../../../'
alias up4='cd ../../../../'

## MacOS
alias singleapp="default write com.apple.dock single-app -bool true; killall dock"
alias multiapp="default write com.apple.dock single-app -bool false; killall dock"

# ls to eza
alias ls="eza"

# cat to bat
alias cat="bat"

# Rails and Dev Tools
alias respec="rerun -cx rspec"

# git
alias gi='git status; echo; git branch -a -v'
alias ggrep='git grep -I'
alias gcme='git commit -m'
alias contains='git branch --contains'
alias grecent='git for-each-ref --count=10 --sort=-committerdate refs/heads/ --format="%(refname:short)"'

# More terse
alias ld='lazydocker'
alias lg="lazygit"

# Extract .tar.gz archive
alias untar="tar -xvzf"

# Generate random secret for an app secret
alias secret="openssl rand -hex 32"

# Makes it easier to sign into 1Password cli
opsign() {
  who=$(op whoami)

	if [[ $? != 0 ]] then;
		eval $(op signin)
  else
    echo "Already signed into 1Password."
	fi
}

#
# Run uncommitted test files
#
run_uncommitted_tests() {
  local test_files

  # Get uncommitted files (staged + unstaged + untracked) that are test files
  # Matches: test/, spec/, engines/*/test/, engines/*/spec/
  test_files=$(git status --porcelain 2>/dev/null | \
    awk '{print $NF}' | \
    grep -E '(^|/)((test|spec)/.*_(test|spec)\.rb$)')

  if [[ -z "$test_files" ]]; then
    echo "No uncommitted test files found."
    return 0
  fi

  echo "Running uncommitted test files:"
  echo "$test_files" | sed 's/^/  /'
  echo ""

  # Build array of files
  local -a files_array
  while IFS= read -r file; do
    files_array+=("$file")
  done <<< "$test_files"

  # Detect test framework and run
  if [[ -f "bin/rails" ]]; then
    RAILS_ENV=test bin/rails test "${files_array[@]}"
  elif [[ -f "bin/rspec" ]]; then
    bin/rspec "${files_array[@]}"
  elif [[ -f "Gemfile" ]] && grep -q "rspec" Gemfile; then
    bundle exec rspec "${files_array[@]}"
  else
    RAILS_ENV=test bundle exec rails test "${files_array[@]}"
  fi
}

alias rut='run_uncommitted_tests'

# Cross-platform alias that uses native package manager to update system.
# Reduces cognitive load when switching systems and stops relying on zsh history to make it quicker.
{{- if eq .chezmoi.os "darwin" }}
alias update="brew update && brew upgrade"
{{- else if eq .chezmoi.os "linux" -}}
{{-   $aptOS := list "linuxmint" "ubuntu" "debian" "raspbian" }}
{{-   if has .chezmoi.osRelease.id $aptOS }}
alias update="sudo apt-get update && sudo apt-get upgrade"
{{-   else if eq .chezmoi.osRelease.id "arch" }}
alias update="sudo pacman -Syu"
{{-  end -}}
{{- end }}

# Include custom aliases
[[ -f ~/.aliases.local ]] && source ~/.aliases.local
